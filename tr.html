<!DOCTYPE html>
<html>
  <head>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js" integrity="sha512-DZqqY3PiOvTP9HkjIWgjO6ouCbq+dxqWoJZ/Q+zPYNHmlnI2dQnbJ5bxAHpAMw+LXRm4D72EIRXzvcHQtE8/VQ==" crossorigin="anonymous"></script>
<link href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>



<!-- JQuery -->
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<!-- TEST

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>



-->
<!-- CSS -->
<!-- Font Awesome -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
<!-- Google Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
<!-- Bootstrap core CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
<!-- Material Design Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.18.0/css/mdb.min.css" rel="stylesheet">

    <meta charset=utf-8 />
    <title>Sistema Casa de Polo</title>
  </head>
        <style>
          table.dataTable thead .sorting:after,
table.dataTable thead .sorting:before,
table.dataTable thead .sorting_asc:after,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc_disabled:after,
table.dataTable thead .sorting_asc_disabled:before,
table.dataTable thead .sorting_desc:after,
table.dataTable thead .sorting_desc:before,
table.dataTable thead .sorting_desc_disabled:after,
table.dataTable thead .sorting_desc_disabled:before {
  bottom: .5em;
}
          body {
  font: 90%/1.45em "Helvetica Neue", HelveticaNeue, Verdana, Arial, Helvetica, sans-serif;
  margin: 0;
  padding: 0;
  color: #333;
  background-color: #fff;
}


td.details-control {
    background: url('https://www.datatables.net/examples/resources/details_open.png') no-repeat center center;
    cursor: pointer;
}
tr.shown td.details-control {
    background: url('https://www.datatables.net/examples/resources/details_close.png') no-repeat center center;
}

      </style>
  <div class="container my-4">

    <p class="font-weight-bold h1"></p> <hr>
  <div class="modal fade" id="modalSubscriptionForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Sistema de registro Polo</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-6">
         
  
  <form  method="POST" action="/">
   <div class="form-group  mx-sm-3 mb-2">
      <input  class="form-contro-sm" type="text" placeholder="Codigo de operacion (OP)" name="op">
      <input  class="form-contro-sm" type="text" placeholder="Referencia" name="referencia">
      <input  class="form-contro-sm" type="number" placeholder="Color" name="color">
      <input  class="form-contro-sm" type="number" placeholder="Cantidad Total" name="cant_total">
      <input  class="form-contro-sm" type="number" placeholder="Talla S" name="cant_tallaS">
      <input  class="form-contro-sm" type="number" placeholder="Talla M" name="cant_tallaM">
      <input  class="form-contro-sm" type="number" placeholder="Talla L" name="cant_tallaL">
      <input  class="form-contro-sm" type="number" placeholder="Talla XL" name="cant_tallaXL">
      <input  class="form-contro-sm" type="number" placeholder="Talla XXL" name="cant_tallaXXL">
      <input  class="form-contro-sm" type="text" placeholder="Nota" name="nota">
        
      <div class="modal-footer d-flex justify-content-center">
      <input type="submit"  class="btn btn-indigo" value="Guardar">
      <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
        
   </div>

  </form>
 
 </div>
 </div>

    </div>
  </div>
</div></div>

<div class="text-center">
  <a href="" class="btn btn-blue btn-rounded mb-4" data-toggle="modal" data-target="#modalSubscriptionForm">Agregar Operacion</a>
</div>

  </div>
     





<table id="example" class="table table-striped table-sm"  cellspacing="0" width="100%">
        <thead>
            <tr>
                <th></th>
                <th>OP</th>
                <th>Referencia</th>
                <th>Cantidad total</th>
                <th>Color</th>
                <th>Fecha</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th></th>
                <th>OP</th>
                <th>Referencia</th>
                <th>Cantidad total</th>
                <th>Color</th>
                <th>Fecha</th>
            </tr>
        </tfoot>
    </table>
    
</div>
    <script>


function format ( d ) {
   // alert(typeof(d.canTerminada));
    //console.log( Object.prototype.toString.call([d.canTerminada]));
    
//$.each([d.canTerminada], function(  key, value ) {
 // alert( key + ": " + value );
//});
    return'<div class="row"><div class="col-3">'+
        '<form method="POST" action="/"><div class="form-group"><center><label class="form-group">'+
        '<h6 class="modal-title w-100 font-weight-bold">Registar tarea</h6></label></center>'+
        '<div class=" "><select class="form-control-sm custom-select" name="id_talla"><option selected>Seleccione Talla</option><option value="1">Talla S</option><option value="2">Talla M</option> <option value="3">Talla L</option><option value="4">Talla XL</option><option value="5">Talla XXL</option><option value="6">Punto</option></select></div>'+
        '<div class="  "><input type="number" class="form-control" id="tsid'+d.op+
        '1" name="can_terminada" aria-describedby="number" placeholder="cantidad"></div>'+
        '<input type="number" hidden="true" id="tsid'+d.op+
        '2" name="id_prenda" aria-describedby="number" value="'+d.id_pr+
        '"><small id="tsh'+d.op+
        '" class="form-text text-muted">Igresa la cantidad terminada</small>'+
        '<div class=""><button class="btn btn-primary form-group" type="submit" onclick="handleForm()" >Guardar</button></div></div>'+
        '</form></div>'+
        '<div class="col-3">'+
        '<center><h6 class="modal-title w-100 font-weight-bold">Cantidad Talla Total</h6></center>'+
        '<br>'+'Talla S: '+d.tallaSS+
        '<br>'+'Talla M: '+d.tallaM+
        '<br>'+'Talla L: '+d.tallaL+
        '<br>'+'TallaS XL: '+d.tallaXL+
        '<br>'+'TallaS XXL: '+d.tallaXXL+

        '</div>'+
        '<div class="col-3">'+
        '<center><h6 class="modal-title w-100 font-weight-bold">Cantidad Registrada</h6></center><br>'+
        'terminada: '+d.canTerminada+'='+d.total+'<br>'+
        '<br>'+'Tallas'+d.tallaS+
        '<br>'+
        'Cantidad faltante: '+d.canFaltante+'<br>'+
        'Nota : '+d.nota+'<br>'+
        'Estatus : Abierta </div>'+

        '<div class="col-3">'+
        '<center><h6 class="modal-title w-100 font-weight-bold">Accion</h6><br></center>'+
        '<div class="container my-4"><p class="font-weight-bold h1"></p><hr><div class="modal fade" id="modalSubscriptionFor" tabindex="-1" role="dialog" aria-labelledby="myModalLabe" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Editar registro Polo</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+
        '</div><div class="modal-body mx-6">'+
        '<form  method="POST" action="./update">'+
        '<div class="form-group  mx-sm-3 mb-2">'+
        '<input  class="form-contro-sm" type="text" placeholder="Codigo de operacion (OP)" name="op" value="'+d.op+'">'+
        '<input type="text" name="opold" hidden="true" value="'+d.op+'">'+
        '<input  class="form-contro-sm" type="text" placeholder="Referencia" name="referencia" value="'+d.referencia+'">'+
        '<input type="text" name="referenciaold" hidden="true" value="'+d.referncia+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Color" name="color" value="'+d.color+'">'+
        '<input type="number" name="colorold" hidden="true" value="'+d.color+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Cantidad Total" name="cant_total" value="'+d.cantidadTotal+'">'+
        '<input type="number" name="cantidadTotalold" hidden="true" value="'+d.cantidadTotal+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Talla S" name="cant_tallaS" value="'+d.tallaSS+'">'+
        '<input type="number" name="cant_tallaSold" hidden="true" value="'+d.tallaSS+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Talla M" name="cant_tallaM" value="'+d.tallaM+'">'+
        '<input type="number" name="cant_tallaMold" hidden="true" value="'+d.tallaM+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Talla L" name="cant_tallaL" value="'+d.tallaL+'">'+
        '<input type="number" name="cant_tallaLold" hidden="true" value="'+d.tallaL+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Talla XL" name="cant_tallaXL" value="'+d.tallaXL+'">'+
        '<input type="number" name="cant_tallaXLold" hidden="true" value="'+d.tallaXL+'">'+
        '<input  class="form-contro-sm" type="number" placeholder="Talla XXL" name="cant_tallaXXL" value="'+d.tallaXXL+'">'+
        '<input type="number" name="cant_tallaXXLold" hidden="true" value="'+d.tallaXXL+'">'+
        '<input  class="form-contro-sm" disabled type="text" placeholder="Nota" name="nota" value="'+d.nota+'">'+
        '<input type="number" name="notaold" hidden="true" value="'+d.nota+'">'+
        '<div class="modal-footer d-flex justify-content-center">'+
        '<input type="submit"  class="btn btn-indigo" value="Guardar">'+
        '<button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>'+
        '</div></form></div></div></div></div></div></div><div class="text-center">'+
        '<a href="" class="btn btn-blue btn-rounded mb-2" data-toggle="modal" data-target="#modalSubscriptionFor"><i class="far fa-edit" aria-hidden="true"></i></a>'+

        '<form method="POST" action="./delete" style="display: inline">'+
        '<input type="hidden" value="'+d.id_pr+'" name="id_pren">'+
        '<input type="hidden" value="'+d.id_operacion+'" name="id_op">'+
        '<button type ="submit" href="" class="btn btn-danger btn-rounded mb-2" ><i class="far fa-trash-alt" aria-hidden="true"></i></button>'+
        '</form></div></div>'+
        '</div>';
}
/*
        
*/
         
function handleForm() {
   console.log("T");
    };

$(document).ready(function() {
  
    var dt = $('#example').DataTable( {
        "processing": false,
        "serverSide": false,
         "ajax": {
            "url": "/test",
            "type": "GET"
        },
        "columns": [ 
            {
                "class":          "details-control",
                "orderable":      false,
                "data":           null,
                "defaultContent": ""
            },
            { "data": "op"},
            { "data": "referencia" },
            { "data": "cantidadTotal" },
            { "data": "color" },
            { "data": "fecha" }
        ],
        "order": [[1, 'asc']]
    } );
 
    // Array to track the ids of the details displayed rows
    var detailRows = [];
 
    $('#example tbody').on( 'click', 'tr td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = dt.row( tr );
        var idx = $.inArray( tr.attr('id'), detailRows );
 
        if ( row.child.isShown() ) {
            tr.removeClass( 'details' );
            row.child.hide();
 
            // Remove from the 'open' array
            detailRows.splice( idx, 1 );
        }
        else {
            tr.addClass( 'details' );
            row.child( format( row.data() ) ).show();
 
            // Add to the 'open' array
            if ( idx === -1 ) {
                detailRows.push( tr.attr('id') );
            }
        }
    } );
 
    // On each draw, loop over the `detailRows` array and show any child rows
    dt.on( 'draw', function () {

        $.each( detailRows, function ( i, id ) {
            $('#'+id+' td.details-control').trigger( 'click' );
        } );
    } );
} );
    </script>




  </body>
</html>
